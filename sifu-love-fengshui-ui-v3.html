<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <title>SIFU Love â€” Feng Shui UI Prototype (v2)</title>
  <style>
    :root{
      --wood:#0f766e; --fire:#f97316; --earth:#e7d7b5; --metal:#c5a76a; --water:#1e3a8a;
      --bg0:#0b1220; --bg1:#0f172a;
      --text:rgba(255,255,255,0.92);
      --muted:rgba(255,255,255,0.68);
      --muted2:rgba(255,255,255,0.52);
      --ok:#34d399;
      --shadow:0 16px 36px rgba(0,0,0,0.45);
      --radius:18px; --radius2:26px;
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(15,118,110,0.35), transparent 55%),
        radial-gradient(900px 600px at 110% 20%, rgba(197,167,106,0.25), transparent 50%),
        radial-gradient(900px 700px at 35% 120%, rgba(30,58,138,0.35), transparent 55%),
        linear-gradient(160deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }
    .bg-bagua{
      position:fixed; inset:-80px -120px auto auto;
      width:420px; height:420px;
      opacity:0.08;
      filter: drop-shadow(0 18px 25px rgba(0,0,0,0.4));
      pointer-events:none;
      transform: rotate(12deg);
    }
    .app{height:100%;display:flex;justify-content:center;align-items:stretch;padding:10px;}
    .phone{
      width:min(420px,100%); height:100%;
      background:rgba(255,255,255,0.03);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:28px;
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
      display:flex; flex-direction:column;
    }
    .topbar{
      padding: calc(14px + var(--safe-top)) 16px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,0.08);
      background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
    }
    .brand{display:flex; align-items:center; gap:10px; min-width:0;}
    .logo{
      width:34px;height:34px;border-radius:12px;
      background:radial-gradient(circle at 30% 30%, rgba(15,118,110,0.9), rgba(30,58,138,0.9));
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,0.14);
      box-shadow:0 10px 18px rgba(0,0,0,0.35);
      flex:0 0 auto;
    }
    .brand h1{margin:0;font-size:14px;letter-spacing:.2px;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .brand .sub{display:block;font-size:11px;color:var(--muted);margin-top:2px;}
    .chip{
      display:inline-flex; align-items:center; gap:6px;
      padding:8px 10px; font-size:12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(255,255,255,0.05);
      color:var(--text);
      user-select:none;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease;
    }
    .chip:active{transform:scale(0.98);}
    .chip small{color:var(--muted);}
    .chip .dot{width:8px;height:8px;border-radius:999px;background:var(--ok);box-shadow:0 0 0 3px rgba(52,211,153,0.15);}
    .chip.off .dot{background:var(--muted2);box-shadow:none;}
    .chip.admin .dot{background:var(--metal);box-shadow:0 0 0 3px rgba(197,167,106,0.18);}
    .content{flex:1 1 auto; overflow:auto; padding:14px 14px calc(86px + var(--safe-bottom)); scroll-behavior:smooth;}
    .section-title{font-size:12px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin:10px 4px;}
    .card{
      border:1px solid rgba(255,255,255,0.12);
      background:linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.04));
      border-radius:var(--radius);
      padding:14px;
      box-shadow:0 10px 18px rgba(0,0,0,0.25);
    }
    .card + .card{margin-top:12px;}
    .hero{
      position:relative;border-radius:var(--radius2);padding:18px 16px;
      border:1px solid rgba(255,255,255,0.12);
      background:
        radial-gradient(850px 350px at 0% 0%, rgba(15,118,110,0.28), transparent 50%),
        radial-gradient(750px 300px at 100% 0%, rgba(197,167,106,0.22), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      overflow:hidden;
    }
    .hero .waterline{
      position:absolute;left:-30%;right:-30%;bottom:-28px;height:80px;
      background:
        radial-gradient(80px 38px at 20% 50%, rgba(30,58,138,0.32), transparent 60%),
        radial-gradient(120px 45px at 50% 30%, rgba(15,118,110,0.24), transparent 65%),
        radial-gradient(100px 42px at 80% 60%, rgba(197,167,106,0.18), transparent 60%);
      filter:blur(2px);opacity:.9;transform:rotate(-2deg);
    }
    .row{display:flex;gap:10px;align-items:center;}
    .col{display:flex;flex-direction:column;gap:8px;}
    .grow{flex:1 1 auto; min-width:0;}
    .h2{margin:0;font-size:18px;letter-spacing:.2px;line-height:1.2;}
    .p{margin:6px 0 0;font-size:13px;color:var(--muted);line-height:1.45;}
    .btn{
      width:100%;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(255,255,255,0.06);
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .btn:active{transform:scale(0.99);}
    .btn.primary{border-color:rgba(15,118,110,0.55);background:linear-gradient(180deg, rgba(15,118,110,0.55), rgba(15,118,110,0.25));}
    .btn.metal{border-color:rgba(197,167,106,0.65);background:linear-gradient(180deg, rgba(197,167,106,0.50), rgba(197,167,106,0.18));}
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,0.14);color:var(--muted);font-weight:600;}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.05);font-size:12px;color:var(--muted);width:max-content;}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.05);color:var(--text);}
    .badge.vip{border-color:rgba(197,167,106,0.6);background:rgba(197,167,106,0.18);}
    .badge.ok{border-color:rgba(52,211,153,0.55);background:rgba(52,211,153,0.16);}
    .badge.lock{border-color:rgba(255,255,255,0.16);background:rgba(255,255,255,0.04);color:var(--muted);}
    .field{display:flex;flex-direction:column;gap:6px;margin-top:10px;}
    label{font-size:12px;color:var(--muted);}
    input,select,textarea{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(0,0,0,0.18);
      color:var(--text);
      outline:none;
    }
    textarea{min-height:88px;resize:vertical;}
    input::placeholder, textarea::placeholder{color:rgba(255,255,255,0.38);}
    .hint{margin-top:6px;font-size:12px;color:var(--muted2);line-height:1.35;}
    .divider{height:1px;background:rgba(255,255,255,0.10);margin:14px 0;}
    .match{display:flex;gap:12px;align-items:flex-start;}
    .avatar{
      width:44px;height:44px;border-radius:16px;
      background:linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.05));
      border:1px solid rgba(255,255,255,0.12);
      display:grid;place-items:center;
      flex:0 0 auto; overflow:hidden;
    }
    .avatar svg{opacity:.95;}
    .name{font-weight:700;font-size:14px;margin:0;}
    .meta{margin:2px 0 0;font-size:12px;color:var(--muted);line-height:1.35;}
    .actions{display:flex;gap:8px;margin-top:10px;}
    .iconbtn{
      flex:1 1 auto;
      border-radius:14px;
      padding:10px 10px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(255,255,255,0.05);
      color:var(--text);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      font-weight:650;
      font-size:13px;
    }
    .iconbtn.like{border-color:rgba(249,115,22,0.55);background:rgba(249,115,22,0.14);}
    .iconbtn.chat{border-color:rgba(15,118,110,0.55);background:rgba(15,118,110,0.14);}
    .iconbtn:active{transform:scale(0.99);}
    .chatlist .item{
      display:flex;gap:12px;align-items:center;
      padding:12px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.04);
      border-radius:16px;
      cursor:pointer;
    }
    .chatlist .item + .item{margin-top:10px;}
    .right{margin-left:auto;color:var(--muted2);font-size:12px;display:flex;flex-direction:column;align-items:flex-end;gap:2px;}
    .chatroom{
      position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.25));
      display:none; flex-direction:column;
    }
    .chatroom.on{display:flex;}
    .chatroom .chat-top{
      padding: calc(14px + var(--safe-top)) 14px 12px;
      display:flex;align-items:center;gap:10px;
      border-bottom:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.25);
    }
    .back{
      width:38px;height:38px;border-radius:14px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(255,255,255,0.05);
      display:grid;place-items:center;
      cursor:pointer;
    }
    .chatroom .thread{flex:1 1 auto;overflow:auto;padding:14px;}
    .bubble{
      max-width:78%;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.06);
      margin-bottom:10px;
      font-size:13px;
      line-height:1.35;
    }
    .bubble.me{margin-left:auto;border-color:rgba(15,118,110,0.45);background:rgba(15,118,110,0.16);}
    .bubble .tiny{margin-top:6px;font-size:11px;color:var(--muted2);}
    .composer{
      padding:10px 10px calc(10px + var(--safe-bottom));
      border-top:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.22);
      display:flex;gap:8px;align-items:flex-end;
    }
    .composer input{border-radius:16px;padding:12px 12px;margin:0;flex:1 1 auto;}
    .send{
      width:46px;height:46px;border-radius:16px;
      border:1px solid rgba(15,118,110,0.55);
      background:rgba(15,118,110,0.18);
      display:grid;place-items:center;
      cursor:pointer; flex:0 0 auto;
    }
    .nav{
      position:absolute;left:0;right:0;bottom:0;
      padding:10px 12px calc(10px + var(--safe-bottom));
      border-top:1px solid rgba(255,255,255,0.10);
      background:linear-gradient(180deg, rgba(0,0,0,0.05), rgba(0,0,0,0.25));
      display:flex;gap:8px;justify-content:space-between;align-items:center;
    }
    .tab{
      flex:1 1 0;
      padding:10px 10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.04);
      cursor:pointer;
      display:flex;flex-direction:column;align-items:center;gap:6px;
      color:var(--muted);
      font-size:11px;
      user-select:none;
    }
    .tab.active{color:var(--text);border-color:rgba(15,118,110,0.50);background:rgba(15,118,110,0.14);}
    .tab svg{opacity:.95;}
    .hidden{display:none !important;}
    .toast{
      position:absolute;left:50%;transform:translateX(-50%);
      bottom:calc(92px + var(--safe-bottom));
      background:rgba(0,0,0,0.55);
      border:1px solid rgba(255,255,255,0.14);
      padding:10px 12px;border-radius:14px;
      color:var(--text);font-size:13px;
      max-width:calc(100% - 26px);
      display:none;
    }
    .toast.on{display:block;animation:pop .18s ease-out;}
    @keyframes pop{from{transform:translateX(-50%) translateY(6px);opacity:0;}to{transform:translateX(-50%) translateY(0);opacity:1;}}
    .js-indicator{
      position:absolute; top:10px; left:10px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(0,0,0,0.35);
      color:var(--muted);
      font-size:11px;
      display:flex; align-items:center; gap:8px;
      z-index:5;
      pointer-events:none;
    }
    .js-indicator .dot{
      width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,0.35);
    }
    html[data-js="on"] .js-indicator{color:var(--text);border-color:rgba(52,211,153,0.35);}
    html[data-js="on"] .js-indicator .dot{background:var(--ok); box-shadow:0 0 0 3px rgba(52,211,153,0.12);}
  
    /* --- Chatroom polish (v3) --- */
    .phone.in-chat .nav{ display:none; }
    .phone.in-chat .content{ overflow:hidden; }

    .chatroom{
      z-index: 50;
      background:
        radial-gradient(900px 420px at 0% 0%, rgba(15,118,110,0.22), transparent 55%),
        radial-gradient(900px 420px at 100% 0%, rgba(197,167,106,0.18), transparent 60%),
        linear-gradient(180deg, rgba(11,18,32,0.98), rgba(15,23,42,0.98));
      backdrop-filter: blur(10px);
    }
    .chatroom .chat-top{
      background: rgba(0,0,0,0.28);
      box-shadow: 0 12px 26px rgba(0,0,0,0.35);
    }
    .chatroom .thread{
      padding: 14px 14px 18px;
    }
    .thread-banner{
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 10px 12px;
      margin-bottom: 12px;
    }
    .thread-title{
      font-size: 12px;
      font-weight: 900;
      letter-spacing: .04em;
    }
    .thread-sub{
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
    }
    .day-divider{
      display:flex;
      align-items:center;
      justify-content:center;
      margin: 10px 0 12px;
      color: var(--muted2);
      font-size: 11px;
    }
    .day-divider span{
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
    }

    /* Bubbles: cleaner spacing + subtle "tail" */
    .bubble{
      position: relative;
      border-radius: 18px;
      padding: 10px 12px;
      margin-bottom: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
    }
    .bubble::after{
      content:"";
      position:absolute;
      left: 10px;
      bottom: -6px;
      width: 14px;
      height: 14px;
      background: rgba(255,255,255,0.06);
      border-left: 1px solid rgba(255,255,255,0.10);
      border-bottom: 1px solid rgba(255,255,255,0.10);
      transform: rotate(45deg);
      border-bottom-left-radius: 4px;
      filter: blur(0.0px);
    }
    .bubble.me{
      background: rgba(15,118,110,0.18);
      border-color: rgba(15,118,110,0.42);
      box-shadow: 0 10px 18px rgba(15,118,110,0.10), 0 8px 16px rgba(0,0,0,0.22);
    }
    .bubble.me::after{
      left: auto;
      right: 10px;
      background: rgba(15,118,110,0.18);
      border-left: none;
      border-bottom: 1px solid rgba(15,118,110,0.28);
      border-right: 1px solid rgba(15,118,110,0.28);
    }

    .composer{
      background: rgba(0,0,0,0.35);
      box-shadow: 0 -10px 26px rgba(0,0,0,0.30);
    }
    .composer input{
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.14);
    }
    .send{
      border-color: rgba(197,167,106,0.55);
      background: rgba(197,167,106,0.16);
    }

  </style>
</head>
<body>
  <svg class="bg-bagua" viewBox="0 0 200 200" aria-hidden="true">
    <defs>
      <linearGradient id="g" x1="0" x2="1">
        <stop offset="0" stop-color="#c5a76a"/>
        <stop offset="1" stop-color="#0f766e"/>
      </linearGradient>
    </defs>
    <circle cx="100" cy="100" r="88" fill="none" stroke="url(#g)" stroke-width="8"/>
    <circle cx="100" cy="100" r="52" fill="none" stroke="rgba(255,255,255,0.6)" stroke-width="6"/>
    <circle cx="100" cy="78" r="18" fill="rgba(255,255,255,0.6)"/>
    <circle cx="100" cy="122" r="18" fill="rgba(0,0,0,0.55)"/>
    <path d="M100 48 L130 60 L152 90 L152 110 L130 140 L100 152 L70 140 L48 110 L48 90 L70 60 Z"
          fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="4"/>
  </svg>

  <div class="app">
    <div class="phone" id="phone">
      <div class="js-indicator"><span class="dot"></span>JS Active</div>

      <div class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 21s-7-4.4-9.3-8.6C.7 8.7 2.6 6 5.6 6c1.8 0 3.3 1 4.1 2.2C10.5 7 12 6 13.8 6c3 0 4.9 2.7 2.9 6.4C19 16.6 12 21 12 21z" stroke="rgba(255,255,255,0.92)" stroke-width="1.8" />
            </svg>
          </div>
          <div class="grow">
            <h1>SIFU Love <span class="sub">Feng Shui UI â€¢ Mobile Web (v2)</span></h1>
          </div>
        </div>

        <button class="chip" id="modeChip" title="åˆ‡æ› VIP / Normal" type="button">
          <span class="dot"></span>
          <span id="modeText">VIP</span>
          <small id="retentionText">1 month</small>
        </button>
      </div>

      <div class="content" id="content"></div>

      <div class="nav" id="nav">
        <div class="tab active" data-tab="home">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 10.5 12 4l8 6.5V20a1.5 1.5 0 0 1-1.5 1.5H5.5A1.5 1.5 0 0 1 4 20v-9.5z" stroke="currentColor" stroke-width="1.8"/></svg>
          Home
        </div>
        <div class="tab" data-tab="match">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 21s-7-4.4-9.3-8.6C.7 8.7 2.6 6 5.6 6c1.8 0 3.3 1 4.1 2.2C10.5 7 12 6 13.8 6c3 0 4.9 2.7 2.9 6.4C19 16.6 12 21 12 21z" stroke="currentColor" stroke-width="1.8"/></svg>
          Matching
        </div>
        <div class="tab" data-tab="chat">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 5.8A2.8 2.8 0 0 1 6.8 3h10.4A2.8 2.8 0 0 1 20 5.8v7.8a2.8 2.8 0 0 1-2.8 2.8H10l-4.8 3.2V16.4A2.8 2.8 0 0 1 4 13.6V5.8z" stroke="currentColor" stroke-width="1.8"/></svg>
          Chat
        </div>
        <div class="tab" data-tab="profile">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 12a4.2 4.2 0 1 0-4.2-4.2A4.2 4.2 0 0 0 12 12zm7.6 9.5a9.4 9.4 0 0 0-15.2 0" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
          Profile
        </div>
      </div>

      <div class="chatroom" id="chatroom">
        <div class="chat-top">
          <button class="back" id="backBtn" type="button" aria-label="è¿”å›">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 6 9 12l6 6" stroke="rgba(255,255,255,0.9)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <div class="row grow" style="gap:10px;">
            <div class="avatar" style="width:40px;height:40px;border-radius:14px;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 12a4.2 4.2 0 1 0-4.2-4.2A4.2 4.2 0 0 0 12 12zm7.6 9.5a9.4 9.4 0 0 0-15.2 0" stroke="rgba(255,255,255,0.85)" stroke-width="1.8" stroke-linecap="round"/></svg>
            </div>
            <div class="grow">
              <div style="font-weight:800; font-size:14px;" id="chatTitle">Alicia â€¢ 27</div>
              <div style="font-size:12px; color:var(--muted);" id="chatSubtitle">Central â€¢ Verified <span style="color:var(--ok)">â—</span></div>
            </div>
          </div>
          <div class="badge" id="chatRetentionBadge" title="Retention policy"></div>
        </div>
        <div class="thread" id="thread">
          <div class="thread-banner" id="threadBanner">
            <div class="thread-title">Tips</div>
            <div class="thread-sub">æ–‡å­—è¨Šæ¯æ°¸ä¹…ä¿ç•™ï¼›åœ–ç‰‡/èªéŸ³æœƒæŒ‰æœƒå“¡ç­‰ç´šåˆ°æœŸã€‚è«‹é¿å…åˆ†äº«æ•æ„Ÿè³‡æ–™ã€‚</div>
          </div>
          <div class="day-divider"><span>Today</span></div>
          <div class="bubble">Hi ğŸ‘‹ æˆ‘ä¿‚ Aliciaã€‚ä»Šæ—¥å˜…é…å°å¥½è‡ªç„¶ï½æƒ³æ…¢æ…¢äº†è§£ä½ ã€‚</div>
          <div class="bubble me">æˆ‘éƒ½ä¿‚ï½æˆ‘å“‹å¯ä»¥å…ˆå–ºåº¦å‚¾ä¸‹ï¼Œä¹‹å¾Œå†æ±ºå®šè¦å””è¦è½‰ WhatsAppã€‚</div>
          <div class="bubble">
            <div><b>[Image]</b> Sunset photo</div>
            <div class="tiny" id="imgExpiryText">Image expires in 30 days</div>
          </div>
          <div class="bubble me">å¥½éšï¼ğŸ‘</div>
        </div>
        <div class="composer">
          <input id="msg" placeholder="è¼¸å…¥è¨Šæ¯â€¦" />
          <button class="send" id="sendBtn" type="button" title="Send">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 12l16-8-6 16-2.2-6.1L4 12z" stroke="rgba(255,255,255,0.9)" stroke-width="2" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </div>

      <div class="toast" id="toast"></div>
    </div>
  </div>

<script>
  document.documentElement.dataset.js = "on";

  const state = {
    vip: true,
    verified: true,
    hiddenProfile: true,
    pausedMatching: false,
    adminMode: false,
    dailyMatches: 3,
  };

  const content = document.getElementById('content');
  const phone = document.getElementById('phone');

  const nav = document.getElementById('nav');
  const tabs = [...document.querySelectorAll('.tab')];
  const modeChip = document.getElementById('modeChip');
  const modeText = document.getElementById('modeText');
  const retentionText = document.getElementById('retentionText');
  const toast = document.getElementById('toast');

  const chatroom = document.getElementById('chatroom');
  const backBtn = document.getElementById('backBtn');
  const sendBtn = document.getElementById('sendBtn');
  const msg = document.getElementById('msg');
  const thread = document.getElementById('thread');
  const imgExpiryText = document.getElementById('imgExpiryText');
  const chatRetentionBadge = document.getElementById('chatRetentionBadge');
  const chatTitle = document.getElementById('chatTitle');

  function showToast(t){
    toast.textContent = t;
    toast.classList.add('on');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove('on'), 1800);
  }

  function setVIP(v){
    state.vip = v;
    modeText.textContent = v ? 'VIP' : 'Normal';
    retentionText.textContent = v ? '1 month' : '3â€“7 days';
    modeChip.classList.toggle('off', !v);

    chatRetentionBadge.textContent = v ? 'VIP retention: 1 month' : 'Normal retention: 3â€“7 days';
    chatRetentionBadge.className = 'badge ' + (v ? 'vip' : '');
    imgExpiryText.textContent = v ? 'Image expires in 30 days' : 'Image expires in 7 days';
    const b = document.getElementById('threadBanner');
    if(b){
      const sub = b.querySelector('.thread-sub');
      if(sub){
        sub.textContent = v ? 'æ–‡å­—è¨Šæ¯æ°¸ä¹…ä¿ç•™ï¼›åœ–ç‰‡/èªéŸ³æœ€é•·ä¿ç•™ 1 å€‹æœˆã€‚è«‹é¿å…åˆ†äº«æ•æ„Ÿè³‡æ–™ã€‚' : 'æ–‡å­—è¨Šæ¯æ°¸ä¹…ä¿ç•™ï¼›åœ–ç‰‡/èªéŸ³ä¸€èˆ¬ä¿ç•™ 3â€“7 æ—¥ã€‚è«‹é¿å…åˆ†äº«æ•æ„Ÿè³‡æ–™ã€‚';
      }
    }
  }

  function icon(name){
    const map = {
      spark: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2l1.6 6.2L20 10l-6.4 1.8L12 18l-1.6-6.2L4 10l6.4-1.8L12 2z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/></svg>`,
      shield:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3 20 7v6c0 5-3.4 8.5-8 9-4.6-.5-8-4-8-9V7l8-4z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/></svg>`,
      lock:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><path d="M7 11h10a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/></svg>`,
      tick:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M20 7 10 17l-5-5" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
      cog:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 15.2A3.2 3.2 0 1 0 12 8.8a3.2 3.2 0 0 0 0 6.4z" stroke="currentColor" stroke-width="1.8"/><path d="M19.4 15a8 8 0 0 0 .1-6l-2.2.3a6.2 6.2 0 0 0-1.5-1.5l.3-2.2a8 8 0 0 0-6-.1l.3 2.2a6.2 6.2 0 0 0-1.5 1.5L6.7 9a8 8 0 0 0-.1 6l2.2-.3a6.2 6.2 0 0 0 1.5 1.5l-.3 2.2a8 8 0 0 0 6 .1l-.3-2.2a6.2 6.2 0 0 0 1.5-1.5l2.2.3z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/></svg>`,
      crown:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 9l4 3 4-6 4 6 4-3v10H4V9z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/></svg>`,
      alert:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 9v5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M12 17h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><path d="M10.3 4.2a2 2 0 0 1 3.4 0l8 13.8a2 2 0 0 1-1.7 3H4a2 2 0 0 1-1.7-3l8-13.8z" stroke="currentColor" stroke-width="1.4"/></svg>`
    };
    return map[name] || '';
  }

  function heroCard(title, subtitle, ctaText, ctaGo){
    return `
      <div class="hero">
        <div class="row" style="align-items:flex-start;">
          <div class="grow">
            <div class="pill">Balanced Matching â€¢ é¢¨æ°´å¼ã€Œå¹³è¡¡æ„Ÿã€ UI</div>
            <h2 class="h2">${title}</h2>
            <p class="p">${subtitle}</p>
          </div>
          <div class="badge ${state.vip ? 'vip' : ''}">
            ${state.vip ? icon('crown') : icon('spark')}
            ${state.vip ? 'VIP' : 'Normal'}
          </div>
        </div>
        <div class="divider"></div>
        <button class="btn primary" type="button" data-go="${ctaGo}">${ctaText}</button>
        <div class="waterline"></div>
      </div>
    `;
  }

  // ---- Screens (NO inline onclick; use data-* and event delegation) ----
  function screenHome(){
    const status = state.verified ? `<span class="badge ok">${icon('tick')} HKID Verified</span>` : `<span class="badge">Not Verified</span>`;
    const lock = state.vip ? `<span class="badge lock" title="VIP only">${icon('lock')} ${state.hiddenProfile ? 'Hidden to public' : 'Visible to public'}</span>` : ``;

    return `
      ${heroCard(
        "ä»Šæ—¥ 3 å€‹é…å°ï¼ˆæ°£å ´æµå‹•ã€æ…¢æ…¢äº†è§£ï¼‰",
        "åº•éƒ¨å°èˆª + Settings æ”¾ Profile è£é¢ï¼›Matching ç”¨å¡ç‰‡åˆ—è¡¨ï¼›Chat é€²èŠå¤©å®¤å¾Œä¸é¡¯ç¤ºåˆ—è¡¨ï¼ˆå°ˆæ³¨ä¸€æ®µé—œä¿‚ï¼‰ã€‚",
        "æŸ¥çœ‹ä»Šæ—¥é…å°",
        "match"
      )}

      <div class="section-title">Your Status</div>
      <div class="card">
        <div class="row">
          <div class="avatar" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 12a4.2 4.2 0 1 0-4.2-4.2A4.2 4.2 0 0 0 12 12zm7.6 9.5a9.4 9.4 0 0 0-15.2 0" stroke="rgba(255,255,255,0.85)" stroke-width="1.8" stroke-linecap="round"/></svg>
          </div>
          <div class="grow">
            <div style="font-weight:800;">Do â€¢ 26</div>
            <div class="meta">Tiong Bahru â€¢ Engineer</div>
          </div>
          ${status}
        </div>

        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge ${state.vip ? 'vip' : ''}">${state.vip ? icon('crown') : icon('spark')} ${state.vip ? 'VIP Member' : 'Normal Member'}</span>
          ${lock}
          <span class="badge" title="Pause matching">${state.pausedMatching ? 'Matching Paused' : 'Matching Active'}</span>
        </div>

        <div class="divider"></div>

        <div class="grid2">
          <button class="btn" type="button" data-go="counsellor">Counsellor Info</button>
          <button class="btn metal" type="button" data-go="vip">${state.vip ? 'VIP Benefits' : 'Upgrade to VIP'}</button>
        </div>
        <div class="hint">
          æç¤ºï¼šæ–‡å­—è¨Šæ¯æ°¸ä¹…ä¿ç•™ï¼›åœ–ç‰‡/èªéŸ³æŒ‰æœƒå“¡ç­‰ç´šæœ‰é™æœŸï¼ˆNormalï¼š3â€“7 æ—¥ï¼›VIPï¼šæœ€å¤š 1 å€‹æœˆï¼‰ã€‚é€™å€‹æé†’æœƒåœ¨èŠå¤©å®¤é¡¯ç¤ºã€‚
        </div>
      </div>

      <div class="section-title">Quick Actions</div>
      <div class="grid2">
        <button class="btn" type="button" data-go="feedback">Submit Feedback</button>
        <button class="btn" type="button" data-go="report">Report an Issue</button>
      </div>

      <div class="divider"></div>

      <div class="card">
        <div class="row">
          <div class="badge" style="border-color: rgba(197,167,106,0.55); background: rgba(197,167,106,0.14);">${icon('shield')} Admin Demo</div>
          <div class="grow"></div>
          <button class="chip admin ${state.adminMode ? '' : 'off'}" type="button" data-action="toggleAdmin">
            <span class="dot"></span><span>${state.adminMode ? 'Admin' : 'User'}</span>
            <small>mode</small>
          </button>
        </div>
        <p class="p" style="margin-top:10px;">
          ä½ å¯ä»¥ç”¨åŒä¸€å€‹ prototype åˆ‡å» Admin/Cifu å¾Œå°ï¼Œç‡å¯©æ‰¹ã€Manual Matchingã€ç›£æ§ç­‰é é¢ã€‚
        </p>
        <button class="btn" type="button" data-go="${state.adminMode ? 'admin' : 'home'}">${state.adminMode ? 'Go Admin Dashboard' : 'Stay in User App'}</button>
      </div>
    `;
  }

  function screenMatch(){
    const demoMatches = [
      {name:"Alicia", age:27, district:"Central", verified:true, vip:false, tagline:"å–œæ­¡æ…¢è·‘ã€ç…®é£¯ã€‚æƒ³æµä¸€å€‹é•·æœŸä¼´ä¾¶ã€‚"},
      {name:"Carmen", age:29, district:"TST", verified:false, vip:true, tagline:"è—è¡“/è¨­è¨ˆã€‚æ›´é‡è¦–æºé€šèˆ‡åƒ¹å€¼è§€ã€‚"},
      {name:"Iris", age:25, district:"Causeway Bay", verified:true, vip:false, tagline:"é‡‘èã€‚é€±æœ«é¾æ„è¡Œå±±åŒå’–å•¡ã€‚"},
      {name:"Yuki", age:28, district:"Wan Chai", verified:false, vip:false, tagline:"æ•™è‚²ã€‚æƒ³å»ºç«‹ç©©å®šå®¶åº­ç¯€å¥ã€‚"},
      {name:"Mina", age:30, district:"Sheung Wan", verified:true, vip:true, tagline:"å¸‚å ´ç‡ŸéŠ·ã€‚ç´°æ°´é•·æµå‹ã€‚"},
    ];
    const picks = demoMatches.slice(0, state.dailyMatches);
    const cards = picks.map((m)=>`
      <div class="card">
        <div class="match">
          <div class="avatar" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 12a4.2 4.2 0 1 0-4.2-4.2A4.2 4.2 0 0 0 12 12zm7.6 9.5a9.4 9.4 0 0 0-15.2 0" stroke="rgba(255,255,255,0.85)" stroke-width="1.8" stroke-linecap="round"/></svg>
          </div>
          <div class="grow">
            <p class="name">${m.name} â€¢ ${m.age} <span style="color:var(--muted); font-weight:700;">(${m.district})</span></p>
            <p class="meta">${m.tagline}</p>
            <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
              ${m.verified ? `<span class="badge ok">${icon('tick')} Verified</span>` : `<span class="badge">Not verified</span>`}
              ${m.vip ? `<span class="badge vip">${icon('crown')} VIP</span>` : ``}
            </div>
          </div>
        </div>
        <div class="actions">
          <button class="iconbtn like" type="button" data-toast="å·²è¡¨é”èˆˆè¶£ï¼ˆLikeï¼‰">${icon('spark')} Like</button>
          <button class="iconbtn chat" type="button" data-chat="${m.name}">${icon('shield')} Chat</button>
        </div>
        <div class="hint">æ¯æ—¥é…å°é è¨­ 3 å€‹ï¼ˆå¯ç”± Admin è¨­å®šï¼‰ã€‚ç¾åœ¨é¡¯ç¤ºï¼š${state.dailyMatches} å€‹ã€‚</div>
      </div>
    `).join('');

    return `
      <div class="section-title">Todayâ€™s Matches</div>
      ${cards}
      <div class="card">
        <div class="row">
          <div class="badge">${icon('spark')} Feng Shui Touch</div>
          <div class="grow"></div>
          <div class="pill">æœ¨ â€¢ ç« â€¢ åœŸ â€¢ é‡‘ â€¢ æ°´</div>
        </div>
        <p class="p" style="margin-top:10px;">
          UI ç”¨ã€Œäº”è¡Œã€åšè‰²å½©åˆ†å±¤ï¼šæœ¨ï¼ˆå’Œè«§/æˆé•·ï¼‰ã€æ°´ï¼ˆæ²‰ç©©/ä¿¡ä»»ï¼‰ã€é‡‘ï¼ˆåƒ¹å€¼/æ‰¿è«¾ï¼‰â€”â€”ä¿æŒç°¡æ½”ã€ç•™ç™½ã€å°ç¨±ï¼Œè®“ç”¨æˆ¶æ„Ÿè¦ºã€Œé †ã€ã€‚
        </p>
      </div>
    `;
  }

  function screenChat(){
    return `
      <div class="section-title">Chats</div>

      <div class="card">
        <div class="row">
          <div class="badge ${state.vip ? 'vip' : ''}">${state.vip ? icon('crown') : icon('spark')} Retention</div>
          <div class="grow"></div>
          <div class="pill">${state.vip ? 'Images/Audio: up to 1 month' : 'Images/Audio: 3â€“7 days'}</div>
        </div>
        <p class="p" style="margin-top:10px;">
          é€²å…¥èŠå¤©å®¤å¾Œï¼Œå””æœƒé¡¯ç¤º chat listï¼ˆå°ˆæ³¨ä¸€æ®µå°è©±ï¼‰ã€‚åœ–ç‰‡è¨Šæ¯æœƒé¡¯ç¤ºåˆ°æœŸæç¤ºï¼›é•·æŒ‰åœ–ç‰‡å¯å„²å­˜åˆ°å…¶ä»– Appsï¼ˆç¤ºæ„ï¼‰ã€‚
        </p>
      </div>

      <div class="chatlist" style="margin-top:12px;">
        <div class="item" data-chat="Alicia">
          <div class="avatar" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 12a4.2 4.2 0 1 0-4.2-4.2A4.2 4.2 0 0 0 12 12zm7.6 9.5a9.4 9.4 0 0 0-15.2 0" stroke="rgba(255,255,255,0.85)" stroke-width="1.8" stroke-linecap="round"/></svg>
          </div>
          <div class="grow">
            <div style="font-weight:800;">Alicia</div>
            <div class="meta">â€œæƒ³æ…¢æ…¢äº†è§£ä½ ã€‚â€</div>
          </div>
          <div class="right">
            <div>11:24</div>
            <div style="color:var(--ok);">â— Online</div>
          </div>
        </div>

        <div class="item" data-chat="Carmen">
          <div class="avatar" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 12a4.2 4.2 0 1 0-4.2-4.2A4.2 4.2 0 0 0 12 12zm7.6 9.5a9.4 9.4 0 0 0-15.2 0" stroke="rgba(255,255,255,0.85)" stroke-width="1.8" stroke-linecap="round"/></svg>
          </div>
          <div class="grow">
            <div style="font-weight:800;">Carmen</div>
            <div class="meta">â€œä½ é¾æ„è¡Œå±±å®šæµ·é‚Šï¼Ÿâ€</div>
          </div>
          <div class="right">
            <div>Yesterday</div>
            <div style="color:var(--muted2);">â—‹ Offline</div>
          </div>
        </div>
      </div>
    `;
  }

  function toggleSwitchRow(title, desc, value, action, disabled=false, badgeHtml=''){
    return `
      <div class="card">
        <div class="row">
          <div class="grow">
            <div style="font-weight:850;">${title} ${badgeHtml}</div>
            <div class="meta">${desc}</div>
          </div>
          <button class="chip ${value ? '' : 'off'}" type="button" ${disabled ? `data-toast="VIP only"` : `data-action="${action}"`}>
            <span class="dot"></span>
            <span>${value ? 'ON' : 'OFF'}</span>
          </button>
        </div>
      </div>
    `;
  }

  function screenProfile(){
    const vipOnly = !state.vip;
    const lockBadge = `<span class="badge lock" title="VIP only">${icon('lock')} VIP</span>`;

    return `
      <div class="section-title">Profile</div>

      <div class="card">
        <div class="row" style="align-items:flex-start;">
          <div class="avatar" aria-hidden="true" style="width:54px;height:54px;border-radius:20px;">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M12 12a4.2 4.2 0 1 0-4.2-4.2A4.2 4.2 0 0 0 12 12zm7.6 9.5a9.4 9.4 0 0 0-15.2 0" stroke="rgba(255,255,255,0.85)" stroke-width="1.8" stroke-linecap="round"/></svg>
          </div>
          <div class="grow">
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
              <div style="font-size:16px; font-weight:900;">Do Huu Hoa</div>
              ${state.vip ? `<span class="badge vip">${icon('crown')} VIP</span>` : `<span class="badge">${icon('spark')} Normal</span>`}
              ${state.verified ? `<span class="badge ok">${icon('tick')} Verified</span>` : `<span class="badge">Not verified</span>`}
            </div>
            <div class="meta" style="margin-top:6px;">Bio: æƒ³å»ºç«‹é•·æœŸé—œä¿‚ï¼›é‡è¦–å°Šé‡ã€ç¯€å¥åŒæ‰¿è«¾ã€‚</div>
            <div class="hint">ç›¸ç‰‡ä¸Šé™ï¼š10 å¼µï¼ˆæ‰€æœ‰ç”¨æˆ¶éƒ½ä¸€æ¨£ï¼‰ã€‚</div>
          </div>
        </div>
      </div>

      <div class="section-title">Settings (inside Profile tab)</div>

      ${toggleSwitchRow(
        "Pause Matching",
        "æš«åœé…å°ï¼šCifu ä¸æœƒå–º matching pool è¦‹åˆ°ä½ ã€‚",
        state.pausedMatching,
        "togglePause"
      )}

      ${toggleSwitchRow(
        "Hide Profile (VIP)",
        "Not visible to public, only visible to Cifu",
        state.hiddenProfile,
        "toggleHidden",
        vipOnly,
        vipOnly ? lockBadge : ""
      )}

      <div class="grid2">
        <button class="btn" type="button" data-go="feedback">${icon('spark')} Feedback</button>
        <button class="btn" type="button" data-go="report">${icon('alert')} Report</button>
      </div>

      <div class="divider"></div>

      <button class="btn metal" type="button" data-go="vip">${state.vip ? 'View VIP Benefits' : 'Upgrade to VIP'}</button>
      <button class="btn ghost" type="button" data-toast="ç¤ºæ„ï¼šLogout">Logout</button>
    `;
  }

  function screenFeedback(){
    return `
      <div class="section-title">User Feedback</div>
      <div class="card">
        <h2 class="h2">Tell us how to improve (3 fields)</h2>
        <p class="p">è¨»å†ŠæœŸé–“åŒç™»å…¥å¾Œéƒ½ç”¨åŒä¸€å¥— Feedback formï¼ˆ3 æ¬„ï¼‰ã€‚</p>

        <div class="field">
          <label>User expectationï¼ˆä½ æœŸæœ›å‘¢å€‹ App æä¾›å’©ï¼Ÿï¼‰</label>
          <textarea placeholder="ä¾‹å¦‚ï¼šå¸Œæœ›é…å°æ›´èªçœŸã€ç¯©é¸æ›´æº–ã€å°è©±æ›´æœ‰å®‰å…¨æ„Ÿâ€¦"></textarea>
        </div>

        <div class="field">
          <label>Suggesting area of improvementï¼ˆå»ºè­°æ”¹å–„ï¼‰</label>
          <textarea placeholder="ä¾‹å¦‚ï¼šæƒ³åŠ ä¸€å€‹ã€åƒ¹å€¼è§€ã€æ¨™ç±¤ã€é…å°ç†ç”±æç¤ºâ€¦"></textarea>
        </div>

        <div class="field">
          <label>Aspect of appreciationï¼ˆä½ æœ€æ¬£è³å˜…åœ°æ–¹ï¼‰</label>
          <textarea placeholder="ä¾‹å¦‚ï¼šä»‹é¢ç°¡æ½”ã€å¯©æ‰¹è®“äººæ”¾å¿ƒã€é…å°ç¯€å¥æ…¢â€¦"></textarea>
        </div>

        <div class="divider"></div>
        <button class="btn primary" type="button" data-toast="å·²æäº¤ Feedbackï¼ˆç¤ºæ„ï¼‰">Submit</button>
      </div>
    `;
  }

  function screenReport(){
    return `
      <div class="section-title">Report</div>
      <div class="card">
        <h2 class="h2">Report scammers / issues</h2>
        <p class="p">åªå¯å–ºç™»å…¥å¾Œæäº¤ Reportï¼Œå¾Œå°å¯è™•ç†ã€‚</p>

        <div class="field">
          <label>Category</label>
          <select>
            <option>Scam / Fraud</option>
            <option>Harassment</option>
            <option>Fake profile</option>
            <option>Other</option>
          </select>
        </div>

        <div class="field">
          <label>Details</label>
          <textarea placeholder="è«‹æè¿°ç™¼ç”Ÿå’©äº‹ï¼Œä¸¦å¯æä¾›æ™‚é–“ã€å°è©±ç·šç´¢â€¦"></textarea>
        </div>

        <div class="divider"></div>
        <button class="btn primary" type="button" data-toast="Report å·²æäº¤ï¼ˆç¤ºæ„ï¼‰">Submit Report</button>
      </div>
    `;
  }

  function screenCounsellor(){
    return `
      <div class="section-title">Counsellor</div>
      <div class="card">
        <h2 class="h2">Cifu Counsellor Info</h2>
        <p class="p">ç‚ºã€ŒèªçœŸé—œä¿‚ã€æä¾›é…å°åŒè¼”å°ï¼šå¯©æ‰¹ã€äººå·¥é…å°ã€è·Ÿé€²ã€‚</p>
        <div class="divider"></div>
        <div class="row">
          <div class="badge">${icon('shield')} Services</div>
          <div class="grow"></div>
          <div class="pill">Manual Matching â€¢ Guidance</div>
        </div>
        <ul style="margin:10px 0 0; padding-left: 18px; color: var(--muted); line-height: 1.6; font-size:13px;">
          <li>å¯©æ‰¹æ–°ç”¨æˆ¶ï¼Œç¢ºä¿åŸºæœ¬å¯ä¿¡åº¦</li>
          <li>æŒ‰æ€§åˆ¥/å¹´é½¡/åœ°å€ç­‰æ¢ä»¶ + äººå·¥åˆ¤æ–·é…å°</li>
          <li>å¿…è¦æ™‚å¼•å°è½‰ WhatsApp ä½œé•·å°è©±</li>
        </ul>
        <div class="divider"></div>
        <button class="btn" type="button" data-toast="ç¤ºæ„ï¼šè¯çµ¡ Counsellor">Contact</button>
      </div>
    `;
  }

  function screenVIP(){
    return `
      <div class="section-title">VIP Membership</div>
      <div class="card">
        <h2 class="h2">${state.vip ? 'VIP Benefits' : 'Upgrade to VIP'}</h2>
        <p class="p">VIP ä¸»è¦å¼·èª¿ï¼šæ›´å¤šé…å°ã€èªéŸ³ã€å„ªå…ˆå›è¦†ã€å¯éš±è— profileã€å»¶é•·åœ–ç‰‡/èªéŸ³ä¿ç•™æœŸï¼ˆæœ€å¤š 1 å€‹æœˆï¼‰ã€‚</p>

        <div class="divider"></div>
        <div class="col">
          <div class="badge vip">${icon('crown')} More matching quota</div>
          <div class="badge vip">${icon('shield')} Audio chat with Cifu</div>
          <div class="badge vip">${icon('spark')} Priority replies</div>
          <div class="badge lock">${icon('lock')} Hide profile (only visible to Cifu)</div>
          <div class="badge vip">${icon('cog')} Extended retention (up to 1 month)</div>
        </div>

        <div class="divider"></div>
        <div class="grid2">
          <button class="btn metal" type="button" data-action="buyVIP">${state.vip ? 'Manage VIP' : 'Monthly HKD 300 (demo)'}</button>
          <button class="btn" type="button" data-toast="ç¤ºæ„ï¼šPer-question credits">Credits Plan</button>
        </div>
        <div class="hint">å®šåƒ¹åŒæ¨¡å¼å¯å¾ŒçºŒèª¿æ•´ï¼›å‘¢åº¦ä¿‚ UI ç¤ºæ„ã€‚</div>
      </div>
    `;
  }

  // ---- Admin ----
  function adminNav(){
    return `
      <div class="section-title">Admin / Cifu</div>
      <div class="card">
        <div class="row">
          <div class="badge" style="border-color: rgba(197,167,106,0.6); background: rgba(197,167,106,0.14);">${icon('shield')} Admin Dashboard</div>
          <div class="grow"></div>
          <div class="pill">Operational Tools</div>
        </div>
        <p class="p" style="margin-top:10px;">å¯©æ‰¹ã€ç®¡ç†ã€äººå·¥é…å°ã€æŸ¥èŠå¤©ã€è™•ç† Reportã€ç³»çµ±ç›£æ§ã€è¨­å®šæ¯æ—¥é…å°æ•¸é‡ã€‚</p>
      </div>

      <div class="grid2" style="margin-top:12px;">
        <button class="btn" type="button" data-go="admin_approval">Approval Queue</button>
        <button class="btn" type="button" data-go="admin_users">User Management</button>
        <button class="btn" type="button" data-go="admin_match">Manual Matching</button>
        <button class="btn" type="button" data-go="admin_chat">Chat History</button>
        <button class="btn" type="button" data-go="admin_reports">Reports</button>
        <button class="btn" type="button" data-go="admin_monitor">System Monitor</button>
        <button class="btn" type="button" data-go="admin_config">System Config</button>
        <button class="btn ghost" type="button" data-action="toggleAdmin">Back to User</button>
      </div>
    `;
  }

  function adminUserRow(title, meta, status){
    return `
      <div class="card" style="padding:12px;">
        <div class="row">
          <div class="grow">
            <div style="font-weight:850;">${title}</div>
            <div class="meta">${meta}</div>
          </div>
          <span class="badge">${status}</span>
        </div>
        <div class="actions" style="margin-top:10px;">
          <button class="iconbtn chat" type="button" data-toast="Approvedï¼ˆç¤ºæ„ï¼‰">Approve</button>
          <button class="iconbtn like" type="button" data-toast="Rejectedï¼ˆç¤ºæ„ï¼‰">Reject</button>
        </div>
      </div>
    `;
  }

  function adminApproval(){
    return `
      <div class="section-title">Approval Queue</div>
      <div class="card">
        <h2 class="h2">Pending Users</h2>
        <p class="p">Admin/Cifu éœ€è¦å¯©æ‰¹ï¼šapprove/rejectã€‚</p>
        <div class="divider"></div>
        ${adminUserRow("Ken â€¢ 24", "Submitted KYC â€¢ 2 photos", "pending")}
        ${adminUserRow("Mia â€¢ 28", "HKID optional â€¢ 7 photos", "pending")}
        <div class="divider"></div>
        <button class="btn" type="button" data-go="admin">Back</button>
      </div>
    `;
  }

  function adminUserMgmtRow(name, status, banned){
    return `
      <div class="card" style="padding:12px;">
        <div class="row">
          <div class="grow">
            <div style="font-weight:850;">${name}</div>
            <div class="meta">Status: ${status}</div>
          </div>
          <button class="chip ${banned ? '' : 'off'}" type="button" data-toast="${banned ? 'Unbanned' : 'Banned'}ï¼ˆç¤ºæ„ï¼‰">
            <span class="dot"></span><span>${banned ? 'Banned' : 'Active'}</span>
          </button>
        </div>
      </div>
    `;
  }

  function adminUsers(){
    return `
      <div class="section-title">User Management</div>
      <div class="card">
        <h2 class="h2">Users</h2>
        <div class="field">
          <label>Search</label>
          <input placeholder="Name / phone / emailâ€¦" />
        </div>
        <div class="divider"></div>
        ${adminUserMgmtRow("Do â€¢ VIP â€¢ Verified", "Active", false)}
        ${adminUserMgmtRow("Carmen â€¢ Normal", "Active", false)}
        ${adminUserMgmtRow("Spammer123", "Banned", true)}
        <div class="divider"></div>
        <button class="btn" type="button" data-go="admin">Back</button>
      </div>
    `;
  }

  function adminMatch(){
    return `
      <div class="section-title">Manual Matching</div>
      <div class="card">
        <h2 class="h2">Search Filters</h2>
        <p class="p">å¤šå€‹å¯é¸æ¬„ä½ï¼šæ€§åˆ¥ã€å¹´é½¡ç¯„åœã€åœ°å€ã€åå­—ã€è·æ¥­ã€å‚™è¨»ã€èŠå¤©é—œéµå­—ã€‚</p>

        <div class="grid2">
          <div class="field"><label>Gender</label><select><option>Any</option><option>Female</option><option>Male</option></select></div>
          <div class="field"><label>District</label><input placeholder="e.g. Central"/></div>
          <div class="field"><label>Age (min)</label><input placeholder="20" /></div>
          <div class="field"><label>Age (max)</label><input placeholder="35" /></div>
        </div>

        <div class="field"><label>Name</label><input placeholder="keyword"/></div>
        <div class="field"><label>Occupation</label><input placeholder="Engineer / Designerâ€¦"/></div>
        <div class="field"><label>Remark (Cifu)</label><input placeholder="internal note"/></div>
        <div class="field"><label>Chat history keywords</label><input placeholder="multiple keywordsâ€¦"/></div>

        <div class="divider"></div>
        <button class="btn primary" type="button" data-toast="Search results (demo)">Search</button>
      </div>

      <div class="card">
        <div class="section-title" style="margin:0 0 8px;">Results</div>
        <div class="chatlist">
          <div class="item">
            <div class="avatar"></div>
            <div class="grow">
              <div style="font-weight:850;">Alicia â€¢ 27 â€¢ Central</div>
              <div class="meta">Remark: â€œsteady, family-orientedâ€</div>
            </div>
            <button class="chip" type="button" data-toast="Match created (demo)"><span class="dot"></span><span>Match</span></button>
          </div>
          <div class="item" style="margin-top:10px;">
            <div class="avatar"></div>
            <div class="grow">
              <div style="font-weight:850;">Do â€¢ 26 â€¢ Tiong Bahru</div>
              <div class="meta">Paused matching: ${state.pausedMatching ? 'Yes (hidden from pool)' : 'No'}</div>
            </div>
            <button class="chip off" type="button" data-toast="Cannot match: paused"><span class="dot"></span><span>Match</span></button>
          </div>
        </div>

        <div class="divider"></div>
        <button class="btn" type="button" data-go="admin">Back</button>
      </div>
    `;
  }

  function adminChat(){
    return `
      <div class="section-title">Chat History</div>
      <div class="card">
        <h2 class="h2">Viewer</h2>
        <p class="p">é¸ç”¨æˆ¶ â†’ é¡¯ç¤ºèŠå¤©è¨˜éŒ„ï¼ˆç¤ºæ„ï¼‰ã€‚</p>
        <div class="field">
          <label>User</label>
          <select><option>Alicia</option><option>Do</option><option>Carmen</option></select>
        </div>
        <div class="divider"></div>
        <div class="bubble">Alicia: â€œæƒ³æ…¢æ…¢äº†è§£ä½ ã€‚â€</div>
        <div class="bubble me">Do: â€œæˆ‘éƒ½ä¿‚ï½â€</div>
        <div class="hint">åœ–ç‰‡/èªéŸ³ä¿ç•™æœŸæŒ‰æœƒå“¡ç­‰ç´šï¼›æ–‡å­—ä¸é™æœŸã€‚</div>
        <div class="divider"></div>
        <button class="btn" type="button" data-go="admin">Back</button>
      </div>
    `;
  }

  function reportRow(cat, who, status){
    return `
      <div class="card" style="padding:12px;">
        <div class="row">
          <div class="grow">
            <div style="font-weight:850;">${cat}</div>
            <div class="meta">${who}</div>
          </div>
          <span class="badge">${status}</span>
        </div>
        <div class="actions" style="margin-top:10px;">
          <button class="iconbtn chat" type="button" data-toast="Action taken (demo)">Resolve</button>
          <button class="iconbtn like" type="button" data-toast="Need investigation (demo)">Investigate</button>
        </div>
      </div>
    `;
  }

  function adminReports(){
    return `
      <div class="section-title">Report Handling</div>
      <div class="card">
        <h2 class="h2">Report Queue</h2>
        <div class="divider"></div>
        ${reportRow("Fake profile", "User: Carmen", "open")}
        ${reportRow("Scam / Fraud", "User: Spammer123", "open")}
        <div class="divider"></div>
        <button class="btn" type="button" data-go="admin">Back</button>
      </div>
    `;
  }

  function statRow(k,v){
    return `
      <div class="row" style="padding:8px 0;">
        <div class="grow" style="color:var(--muted); font-size:13px;">${k}</div>
        <div style="font-weight:850;">${v}</div>
      </div>
    `;
  }

  function adminMonitor(){
    return `
      <div class="section-title">System Monitoring</div>
      <div class="card">
        <h2 class="h2">Stats (Demo)</h2>
        <p class="p">CPU / Memory / Usage + User stats + Storage statsï¼ˆç¤ºæ„ï¼‰ã€‚</p>
        <div class="divider"></div>
        ${statRow("CPU", "23%")}
        ${statRow("Memory", "61%")}
        ${statRow("Online users", "87")}
        ${statRow("Chats today", "140")}
        ${statRow("Storage (pictures/audio)", "12.4 GB / 100 GB")}
        <div class="divider"></div>
        <button class="btn" type="button" data-go="admin">Back</button>
      </div>
    `;
  }

  function adminConfig(){
    return `
      <div class="section-title">System Configuration</div>
      <div class="card">
        <h2 class="h2">Daily Matches</h2>
        <p class="p">è¨­å®šæ¯æ—¥é…å°æ•¸é‡ï¼ˆé è¨­ 3ï¼‰ã€‚</p>

        <div class="field">
          <label>Matches per day</label>
          <input id="mPerDay" type="number" min="1" max="10" value="${state.dailyMatches}" />
          <div class="hint">ç¤ºæ„ï¼šæ”¹å®Œå¾Œï¼ŒUser Matching é é¢æœƒå³æ™‚é¡¯ç¤ºæ–°æ•¸é‡ã€‚</div>
        </div>

        <div class="divider"></div>
        <button class="btn primary" type="button" data-action="saveConfig">Save</button>
        <button class="btn" type="button" data-go="admin">Back</button>
      </div>
    `;
  }

  const routes = {
    home: screenHome,
    match: screenMatch,
    chat: screenChat,
    profile: screenProfile,
    feedback: screenFeedback,
    report: screenReport,
    counsellor: screenCounsellor,
    vip: screenVIP,

    admin: adminNav,
    admin_approval: adminApproval,
    admin_users: adminUsers,
    admin_match: adminMatch,
    admin_chat: adminChat,
    admin_reports: adminReports,
    admin_monitor: adminMonitor,
    admin_config: adminConfig,
  };

  function go(name){
    if(!routes[name]) name = 'home';
    tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab === name));
    if(name.startsWith('admin')) tabs.forEach(t=>t.classList.remove('active'));
    content.innerHTML = routes[name]();
    chatroom.classList.remove('on');
    phone.classList.remove('in-chat');
    content.scrollTop = 0;
    nav.classList.remove('hidden');
  }

  function openChat(name){
    chatTitle.textContent = `${name} â€¢ (demo)`;
    chatroom.classList.add('on');
    phone.classList.add('in-chat');
    // ensure thread is scrolled to bottom for readability
    setTimeout(()=>{ thread.scrollTop = thread.scrollHeight; }, 0);
    showToast(`é€²å…¥èŠå¤©å®¤ï¼š${name}`);
  }

  backBtn.addEventListener('click', ()=>{
    chatroom.classList.remove('on');
    phone.classList.remove('in-chat');
    phone.classList.remove('in-chat');
    showToast('è¿”å› Chat list');
  });

  sendBtn.addEventListener('click', ()=>{
    const t = msg.value.trim();
    if(!t) return;
    const div = document.createElement('div');
    div.className = 'bubble me';
    div.textContent = t;
    thread.appendChild(div);
    thread.scrollTop = thread.scrollHeight;
    msg.value = '';
  });

  // Bottom tabs
  tabs.forEach(t=>t.addEventListener('click', ()=>go(t.dataset.tab)));

  // VIP toggle
  modeChip.addEventListener('click', ()=>{
    setVIP(!state.vip);
    showToast(state.vip ? 'åˆ‡æ›ï¼šVIP' : 'åˆ‡æ›ï¼šNormal');
    const active = tabs.find(t=>t.classList.contains('active'));
    const current = active ? active.dataset.tab : (state.adminMode ? 'admin' : 'home');
    go(current);
  });

  // Actions map
  const actions = {
    togglePause(){
      state.pausedMatching = !state.pausedMatching;
      showToast(state.pausedMatching ? 'å·²æš«åœé…å°' : 'å·²æ¢å¾©é…å°');
      go('profile');
    },
    toggleHidden(){
      if(!state.vip){ showToast('VIP only'); return; }
      state.hiddenProfile = !state.hiddenProfile;
      showToast(state.hiddenProfile ? 'Profile å·²éš±è—ï¼ˆåªè¦‹æ–¼ Cifuï¼‰' : 'Profile å·²å…¬é–‹');
      go('profile');
    },
    buyVIP(){
      if(state.vip){ showToast('VIP ç®¡ç†ï¼ˆç¤ºæ„ï¼‰'); return; }
      setVIP(true);
      showToast('å·²å‡ç´š VIPï¼ˆç¤ºæ„ï¼‰');
      go('vip');
    },
    toggleAdmin(){
      state.adminMode = !state.adminMode;
      showToast(state.adminMode ? 'Admin mode' : 'User mode');
      go(state.adminMode ? 'admin' : 'home');
    },
    saveConfig(){
      const el = document.getElementById('mPerDay');
      const v = Math.max(1, Math.min(10, parseInt(el.value || '3', 10)));
      state.dailyMatches = v;
      showToast(`å·²ä¿å­˜ï¼šæ¯æ—¥é…å° ${v} å€‹`);
      go('admin_config');
    }
  };

  // Event delegation for all dynamic content
  content.addEventListener('click', (e)=>{
    const el = e.target.closest('[data-go],[data-chat],[data-toast],[data-action]');
    if(!el) return;
    if(el.dataset.go) return go(el.dataset.go);
    if(el.dataset.chat) return openChat(el.dataset.chat);
    if(el.dataset.toast) return showToast(el.dataset.toast);
    if(el.dataset.action && actions[el.dataset.action]) return actions[el.dataset.action]();
  });

  // Also allow chat list items to open chat (they use data-chat on .item)
  // (Handled by the same delegation because chat list is rendered into #content)

  setVIP(state.vip);
  go('home');
</script>
</body>
</html>
